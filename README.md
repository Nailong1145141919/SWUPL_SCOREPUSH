# 成绩推送助手

这是一个基于 Python 和 GitHub Actions 的自动化脚本，旨在帮助西南政法大学的学生自动查询成绩并在有新成绩时通过 WxPusher 推送通知。

> **⚠️ 重要提醒**
> 本项目目前仅适配**西南政法大学**的教务系统(**正方教务系统**)。非西南政法大学的学生如果想使用此脚本，需要自行修改 `getscore.py` 文件中的 `url` 变量以及可能的 `headers` 和 `data` 参数，以适配您所在学校的教务系统。

> **⚠️ 重要提醒**
> 请手动删除**grades_json_old.json**内的文件内容！！！

## ✨ 项目特色

* **自动化运行**: 利用 GitHub Actions，可以设定为每小时自动运行一次，无需手动操作。
* **实时通知**: 一旦有新成绩发布，脚本会立刻通过 WxPusher 发送通知给你，让你第一时间了解成绩情况。
* **易于部署**: 只需要 下载 本项目并上传到 GitHub中，并对 `secrets` 进行简单的配置，就可以马上使用。
* **保护隐私**: 所有的敏感信息，如 `Cookie` 和 `appToken`，都存储在 GitHub 的 `Secrets` 中，不会泄露给任何人。

## 🚀 工作流程

1.  **定时触发**: GitHub Actions 会根据预设的 `cron` 表达式（默认为每小时的0分）自动触发工作流。
2.  **获取成绩**: `getscore.py` 脚本会模拟浏览器请求，登录到西南政法大学的教务系统，并获取最新的成绩信息。
3.  **对比成绩**: `main.py` 脚本会读取 `grades_json_old.json` 文件中存储的旧成绩，并将其与新获取的成绩进行对比。
4.  **判断更新**:
    * 如果新成绩的总数大于旧成绩，说明有新成绩发布。
    * 脚本会把新发布的成绩信息整合成一条消息。
5.  **推送通知**: `pushChange.py` 脚本会调用 WxPusher 的 API，将新成绩的通知推送到你的微信。
6.  **更新记录**: 如果有新成绩，`writefile.py` 脚本会用最新的成绩数据更新 `grades_json_old.json` 文件，为下一次查询做准备。
7.  **代码提交**: GitHub Actions 会自动将更新后的 `grades_json_old.json` 文件提交到你的仓库中。

## 🛠️ 如何配置和使用

### 第一步：下载本项目并建立仓库

在GitHub中点击本项目页面右上角的 **CODE** 按钮，点击Download Zip下载完整代码。**自行建立仓库防止可能出现的各种问题。**
如果您认为你有独立解决问题的能力，可以选择fork。

### 第二步：配置 GitHub Secrets

为了让项目正常运行，你需要在你的仓库中设置以下 `Secrets`。请进入你 Fork 的仓库，点击 **Settings** -> **Secrets and variables** -> **Actions**，然后点击 **New repository secret** **分别**添加以下 `Secrets`：

| Secret         | 描述                                                                                                                        | 如何获取                                                                                                                                                                                                                                                                                                       |
| -------------- | --------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `COOKIE`       | 用于登录教务系统的身份认证信息。                                                                                            | 见下文                                                                                            |
| `XNM`          | 学年。例如：`2024`                                                                                                          |                                                                                                                                                                                                                                                                                                                    |
| `XQM`          | 学期。`3` 代表第一学期，`12` 代表第二学期。                                                                                 |                                                                                                                                                                                                                                                                                                                    |
| `APPTOKEN`     | WxPusher 应用的 `appToken`，用于发送通知。                                                                                    | 前往 [WxPusher 官网](https://wxpusher.zjiecode.com/)，创建一个应用，然后你就能在应用管理页面找到 `appToken`。                                                                                                                                                                                             |
| `TOPICIDS`     | WxPusher 的主题 ID，用于将消息发送给订阅了该主题的用户。                                                                      | 在 WxPusher 的主题管理页面创建主题，然后获取主题 ID。                                                                                                                                                                                                                                                |
| `UIDS`         | WxPusher 用户的 `UID`，用于将消息发送给指定的用户。                                                                         | 关注你的 WxPusher 应用的微信公众号，然后在用户管理页面找到你的 `UID`。                                                                                                                                                                                                                                   |

**注意**: `TOPICIDS` 和 `UIDS` 至少需要填写一个。如果两者都填写，通知会同时发送给主题的订阅者和指定的用户。
#### **关于Cookie的获取**
这里使用Windows系统，Edge浏览器演示，不同系统、浏览器之间有些许差异。

1. 
   在教务系统查询成绩页面点击键盘F12或右键点击检查，打开**开发者工具**
   ![step1](/tutorial/PixPin_2025-07-10_07-50-16.png)
   
2. 
   点击网络/NetWork
   ![step2](tutorial/PixPin_2025-07-10_07-50-32.png)
   
3. 
   点击清除按钮（这一步是为了更好的找到下面的请求）
   ![step3](tutorial/PixPin_2025-07-10_07-51-25.png)

4.
   点击查询按钮
  ![step4](tutorial/PixPin_2025-07-10_07-51-47.png)

5. 
   在开发者工具-网络中找到这条请求 
  ![step5](tutorial/PixPin_2025-07-10_07-52-14.png)
  
6. 
   双击打开后在标头/Headers中下拉，找到请求标头/Request Headers-Cookie，复制即可。
    ![step6](tutorial/PixPin_2025-07-10_07-52-54.png)
  
### 第三步：启用 GitHub Actions

0.  在Settings-Actions-General-Workflow permissions中，选择Read and write permissions并保存。
1.  进入你 Fork 的仓库页面，点击 **Actions** 选项卡。
2.  如果看到一个 "I understand my workflows, go ahead and enable them" 的按钮，请点击它来启用 GitHub Actions。
3.  你可以通过点击 **Score Push Workflow** -> **Run workflow** -> **Run workflow** 来手动触发一次工作流，以测试配置是否正确。

## 📁 文件说明

* **`main.py`**: 项目的主入口文件，负责协调各个模块完成成绩的获取、对比、推送和记录。
* **`getscore.py`**: 负责从教务系统获取成绩数据。
* **`pushChange.py`**: 负责将新成绩的通知推送到 WxPusher。
* **`writefile.py`**: 负责将最新的成绩数据写入到 `grades_json_old.json` 文件中。
* **`grades_json_old.json`**: 用于存储上一次查询到的成绩信息，以便于和新成绩进行对比。
* **`.github/workflows/main.yml`**: GitHub Actions 的配置文件，定义了自动化的工作流程。
* **`tutorial/`**: 存放教程图片。
  
## ⚠️ 免责声明

* 本项目仅供学习和交流使用，请勿用于非法用途。
* 请确保你的 `Cookie` 和其他敏感信息的安全，不要泄露给他人。
* 由于学校教务系统可能会更新，本脚本可能会失效。如果遇到问题，欢迎提交 `Issue`。
